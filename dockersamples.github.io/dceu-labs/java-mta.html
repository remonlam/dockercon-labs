<!-- Remove the comments to compress html

---
layout: compress
--- 

-->
<!DOCTYPE html>
<html>

  <head>
<title>Modernizing Traditional Java Applications</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Modernizing Traditional Java Applications" />
<meta name="twitter:description" content="Learn docker through online trainings in training.play-with-docker.com" />
<meta name="twitter:image" content="http://birthday.play-with-docker.com/images/simple-logo.jpg" />

  


<link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans" />

<style>
          
          html,body{height:100%}img{max-width:100%}.mt50{margin-top:50px}.mt20{margin-top:20px}.mt10{margin-top:10px}.mb10{margin-bottom:10px}body{display:flex;flex-direction:column}body>*{flex:none}.navbar{border-radius:0px;margin-bottom:0px}.navbar.navbar-inverse{background-color:#1488C6;border-color:#1488C6}.navbar.navbar-inverse a,.navbar.navbar-inverse .navbar-nav li a{color:white}.navbar.navbar-inverse a:hover,.navbar.navbar-inverse .navbar-nav li a:hover{text-decoration:underline}.navbar-brand{font-weight:900}@media screen and (max-width: 600px){.navbar-brand{font-size:1.5em}}.post-meta{color:#828282}div.post-content{max-width:1200px}.panel{border:none;box-shadow:0px 0px 1px #828282}.panel:hover{box-shadow:0px 0px 6px #828282}footer{border-top:1px solid #e8e8e8}.social-share{margin-top:10px;margin-bottom:15px;text-align:center}.social{list-style:none;display:inline;margin-left:10px;padding:5px 8px}.social:hover{opacity:0.7}.social img{width:20px}.quora img{width:17px}.facebook img{width:16px}.recent ul{list-style:none;padding:0;text-align:justify}.recent li{margin:20px}.recent img{display:block;margin:auto}.recent{padding:10px;border:1px solid #e8e8e8}.post-img img{width:100%}.announce{margin-top:10px;margin-bottom:60px;text-align:center}.pack{display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;flex-wrap:wrap;-webkit-flex-wrap:wrap}.banner{display:block;margin:auto}.panel-container{display:flex;flex-direction:row;overflow:hidden;height:100%;flex:1 1 auto;xtouch-action:none}.terminal{font-size:15px}.panel-left{flex:0 0 auto;width:50%;min-width:150px}.content{padding:0 15px;overflow-y:auto}.content{padding:0 15px}.panel-singular{margin:0 auto;max-width:1200}.splitter{flex:0 0 auto;width:18px;background:url(https://raw.githubusercontent.com/RickStrahl/jquery-resizable/master/assets/vsizegrip.png) center center no-repeat #2fa8c3;min-height:200px;cursor:col-resize}.panel-right{display:flex;flex-direction:column;flex:1 1 auto;width:100%;background:#565656}.panel-right>div{flex:1 1 auto;margin-bottom:15px;overflow-y:auto}.panel-right>div:last-of-type{margin-bottom:0px}.panel-right>div.initialized{background-color:black}.getting-started ul{list-style-type:none;font-size:36px}.card{float:none}code[class*="."]{cursor:pointer}.resize-warning{background-color:black;color:white;text-align:center}.tab{display:none}.site-title{color:white}.post-tag{display:inline-block;background:rgba(42,122,226,0.15);padding:0 .5rem;margin-right:.5rem;border-radius:4px;color:#2a7ae2;font-family:"Open Sans",serif;font-size:90%}.post-tag:before{content:"\f02b";font-family:FontAwesome;padding-right:.5em}.post-tag:hover{text-decoration:none;background:#2a7ae2;color:#fff}small .post-tag{background:#eee;color:#000}small .post-tag:before{content:none}small .post-tag:hover{text-decoration:none;background:#000;color:#fff;cursor:default}.tags-expo :target:before{content:"";display:block;height:72px;margin:-72px 0 0}@media (min-width: 38em){.tags-expo .tags-expo-list{font-size:2.9rem}.tags-expo .tags-expo-list .post-tag{margin:.2em .3em}}.tags-expo .tags-expo-section{font-family:"Open Sans",serif}.tags-expo .tags-expo-section ul{list-style-type:circle;list-style-position:inside;padding:0}.tags-expo .tags-expo-section ul li{padding:0 1rem}.tags-expo .tags-expo-section ul li:hover{list-style-type:disc}.tags-expo .tags-expo-section a{font-size:20px}.tags-expo .tags-expo-section .post-date{display:inline-block;font-size:80%;color:#000;margin:0;padding:0}

</style>  

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="Hands-on Labs: DockerCon EU 2017" href="http://dockersamples.github.io/dceu-labs/dceu-labs/feed.xml">  
<link rel="stylesheet" href="css/quiz.css.html">
</head>


  <body>

    <header class="site-header">
<nav class="navbar navbar-default navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <h3 class="site-title">Hands-on Labs: DockerCon EU 2017</h3>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse " id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
            <li><a href="about/index.html">About</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
</header>


    
<div class="panel-container">
    
    <div class="panel-left content">
    
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

            <header class="post-header">
                <h1 class="post-title" itemprop="name headline">Modernizing Traditional Java Applications</h1>
                <p class="post-meta"><time datetime="2017-01-01T00:00:00+00:00" itemprop="datePublished">Jan 1, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">@manomarks</span></span></p>

            </header>

            <div class="post-content" itemprop="articleBody">
                <p>In this Hands-on Lab, we will show you how to take a traditional Java EE app, and compile it to run in a lightweight Java container. The app we’ve chosen is an old Java EE demo called Movie Plex 7 that was originally written to run in Wildfly 3. You can find our fork of the repo in our <a href="https://github.com/dockersamples/javaee-demo">javaee-demo</a> repository on GitHub. In fact, if you were to take that repository, and lift the <a href="https://github.com/dockersamples/javaee-demo/blob/master/ear/movieplex7-1.0-SNAPSHOT.ear">movieplex7-1.0-SNAPSHOT</a> file, you could run that in a Java Application Server, such as WebLogic, Wildfly, or WebSphere.</p>

<blockquote>
  <p>If you aren’t yet familiar with the basic concepts of Docker, you may wish to start with the Docker 101 lab before running this lab.</p>
</blockquote>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
  <li><a href="java-mta.html#0">Task 0: The Play with Docker Lab Environment</a></li>
  <li><a href="java-mta.html#1">Task 1: Building the App in a Container</a></li>
  <li><a href="java-mta.html#2">Task 2: Adding a New Front-end</a></li>
  <li><a href="java-mta.html#3">Task 3: Moving from Wildfly to Tomcat EE</a></li>
</ul>

<h2 id="step-0-the-play-with-docker-lab-environment"><a name="0"></a>Step 0: The Play with Docker Lab Environment</h2>

<p>The terminal window on the right hand side of this web page is a Linux-based Docker host running in the Play with Docker (PWD) lab environment. This is where you will run all of the commands in this lab.</p>

<p>There are two ways of running commands in the terminal:</p>
<ul>
  <li>Single-clicking any command will paste it into the terminal and execute it</li>
  <li>You can manually type each command into the terminal</li>
</ul>

<h2 id="step-1-building-the-app-in-a-container"><a name="1"></a>Step 1: Building the App in a Container</h2>

<p>In this section of the lab, you are going to take a Java EE web app running on Wildfly, move it to Tomcat EE, and run it in a Docker container.</p>

<p>The easiest way to move an enterprise Java app into Docker is create a WAR file and deploy it to the app server.</p>

<p>Clone the lab repo into the PWD lab. Remember, you can click the command or manually type it into the terminal window.</p>

<pre><code class="language-.term1">git clone https://github.com/dockersamples/javaee-demo
cd javaee-demo
</code></pre>

<p>You will build the application using Maven and deploy it to container to see how it looks. Building and deploying the application can be done without having either Maven or an application server on your computer.</p>

<p>First, look at how the original application works. You can do this by building the application in Docker using a Wildfly container which was the app server the project first used. Although the GitHub repo contains an EAR file, you will build the application from source and deploy it using a multi-stage build Dockerfile. Here’s the text of the two-stage <a href="https://github.com/dockersamples/javaee-demo/blob/master/movieplex7/Dockerfile.wildfly">Dockerfile.wildfly</a> file that you can find in the <code class="highlighter-rouge">movieplex7</code> directory.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>FROM maven:3-jdk-7 AS app
WORKDIR /usr/src/movieplex7
COPY pom.xml .
RUN mvn -B -f pom.xml -s /usr/share/maven/ref/settings-docker.xml dependency:resolve
COPY . .
RUN mvn -B -s /usr/share/maven/ref/settings-docker.xml package -DskipTests

FROM jboss/wildfly
RUN /opt/jboss/wildfly/bin/add-user.sh admin Admin --silent
COPY --from=app /usr/src/movieplex7/target/movieplex7-1.0-SNAPSHOT.war .
EXPOSE 8080 9990
CMD ["/opt/jboss/wildfly/bin/standalone.sh", "-b", "0.0.0.0", "-bmanagement", "0.0.0.0"]
</code></pre>
</div>

<p>The first part of the Dockerfile uses a maven container to build the war file. Instead of building the application locally, it is built inside the container with the tool chain needed to compile the application. In the second part of the Dockerfile, you use a Wildfly container and copy the war file built in the previous container to the app server for deployment.</p>

<p>There are a few additional commands to expose the ports and start Wildfly.</p>

<p>Here’s how to build the app:</p>

<pre><code class="language-.term1">cd movieplex7
docker image build -t movieplex7 -f Dockerfile.wildfly .
</code></pre>

<p>This creates a Docker image with the application deployed on Wildfly.</p>

<p>To run the application:</p>

<pre><code class="language-.term1">docker container run -d -p 8080:8080 --name movieplex7 movieplex7
</code></pre>

<p><a href="http://dockersamples.github.io/movieplex7-1.0-SNAPSHOT" data-term=".term1" data-port="8080">Click here to see it running</a></p>

<p><img src="images/wildfly-movieplex7.png" alt="Movieplex7 Landing Page in Wildfly" /></p>

<p>Your app is working just fine in Docker now, with no code changes and running in the original app server. Feel free to play around with the functionality of the site to understand the app better.</p>

<h2 id="step-2-adding-a-new-front-end"><a name="2"></a>Step 2: Adding a New Front End</h2>

<p>One of the big advantages of containers is that they can ease the process of updating older applications by replacing parts of the application as needed. Java EE also makes it easy to consume the output of your application in different ways. This allows you to easily add a different client to an application.</p>

<h3 id="react-client">React Client</h3>

<p>In this section, you will update the Movie Plex 7 application by adding more attributes to the movie entity and also updating the presentation layer by writing a new client using <a href="https://reactjs.org/">React</a>. Don’t worry, all the code is provided, you don’t need to know React.</p>

<p>As you saw earlier, the JavaServer Faces client was rather sparse and old-fashioned looking. You want to make the movie listing to include movie posters as well as more information about each movie. To do that, you will add a few attributes to the Movie entity, and include a path to a movie poster, and more information about the cast and the movie rating.</p>

<p>The Movie Plex 7 application includes a REST interface for querying movies. This simplifies writing a new client because you can use the API and get data via REST. The javaScript client is a bit more descriptive than the original JavaServer Faces client.</p>

<p><img src="images/react-movieplex7-2.png" alt="Movieplex7 App with a React JS client displaying movie posters" /></p>

<p>To get a separation of the new client from the existing client and server, you will deploy the React client in a separate container.</p>

<p>To get ready, stop and remove the running container, and then change the directory from <code class="highlighter-rouge">movieplex7</code> to the root of the project. Due to a quirk in how React is built, and the base url of the Play with Docker lab, before you build the React client you need to run a script to inject the host URL into the Dockerfile:</p>

<pre><code class="language-.term1">docker container stop movieplex7
docker container rm movieplex7
cd ..
more react-client/Dockerfile
</code></pre>

<div class="highlighter-rouge"><pre class="highlight"><code>FROM node:latest
ENV API_HOST=pwd10-0-16-3-8080.host4.labs.play-with-docker.com
WORKDIR /usr/src/react-client
COPY . .
RUN npm install
RUN npm run build
EXPOSE 3000
CMD ["npm", "run", "start"]
</code></pre>
</div>

<p>React uses Node.js to build a static site for the interface. The Dockerfile is much simpler than the one for the <code class="highlighter-rouge">movieplex7</code> app. It uses a single-stage build, which passes the environment variable <code class="highlighter-rouge">API_HOST</code> to the builder. When it runs, it will start a simple Node server that serves the React pages, and exposes them on port 3000. We’ll deploy it in the next section.</p>

<h2 id="step-3-moving-from-wildfly-to-tomcat-ee"><a name="3"></a>Step 3: Moving from Wildfly to Tomcat EE</h2>

<p>In Step 1, you compiled and deployed the Movie Plex 7 application from source by building it in a Maven container and then deploying it in a Wildfly container. The JavaServer Faces front-end was integrated into the the same application image.</p>

<p>In this step you will make three changes. First, as described in the previous step, you will use a React front-end deployed in a second container. Second, you will deploy the app in a Tomcat EE application server instead of Wildfly. Last, you will deploy both at the same time using a Docker Compose file.</p>

<p>The new front-end is described in the last section, so take a look at the new Dockerfile that deploys your app using the Tomcat Server.</p>

<pre><code class="language-.term1">more movieplex7/Dockerfile
</code></pre>

<div class="highlighter-rouge"><pre class="highlight"><code>FROM maven:latest AS app
WORKDIR /usr/src/movieplex7
COPY pom.xml .
RUN mvn -B -f pom.xml -s /usr/share/maven/ref/settings-docker.xml dependency:resolve
COPY . .
RUN mvn -B -s /usr/share/maven/ref/settings-docker.xml package -DskipTest

FROM tomee:8-jre-7.0.2-plume

# tomcat-users.xml sets up user accounts for the Tomcat manager GUI
# and script access for Maven deployments
WORKDIR /usr/local/tomee/
ADD tomcat/tomcat-users.xml conf/
ADD tomcat/web.xml conf/
# copy and deploy application
WORKDIR /usr/local/tomee/webapps/
COPY --from=app /usr/src/movieplex7/target/movieplex7-1.0-SNAPSHOT.war .
# start tomcat7
EXPOSE 8080
CMD ["catalina.sh", "run"]
</code></pre>
</div>

<p>You’ll see that the first stage is very similar to <code class="highlighter-rouge">Dockerfile.wildfly</code>. Only instead of using <code class="highlighter-rouge">maven:3-jdk-7</code> as the base image, it uses <code class="highlighter-rouge">maven:latest</code>. There’s still no code change, you are still compiling the code into a WAR file. The second stage is a bit different, because it uses a different application server. But the end result is the same application running on both.</p>

<p>You now have two Dockerfiles, one to build the Java Movie Plex 7 application and another to build the React javaScript client. Running a build for each will result in two images. You can individually run each image with the appropriate flags, but a simpler and more consistent solution is to use Docker Compose to start both images as containers that are connected by a network defined in Docker. Another nice thing about Docker Compose is that you can also build the images without having to do a separate <code class="highlighter-rouge">docker image build</code> command for each image. This is the <code class="highlighter-rouge">docker-compose.yml</code> file in the project root:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>version: "3.3"

services:
  movieplex7:
    build:
      context: ./movieplex7
    image: movieplex7-tomee
    ports:
      - "8080:8080"
    networks:
      - www

  react-client:
    build:
      context: ./react-client
    image: react-client
    ports:
      - "80:3000"
    networks:
      - www

networks:
    www:
</code></pre>
</div>

<p>The Compose file defines each service and the ports that they are mapped to. Of note is the react-client, which maps the public port 80 to the private in-container port of 3000.</p>

<p>To run and build the images use:</p>

<pre><code class="language-.term1">docker-compose up --build -d
</code></pre>

<p>Once it’s completed building, which the first time can take awhile, we can check on the status of the containers:</p>

<pre><code class="language-.term1">docker container ls
</code></pre>

<div class="highlighter-rouge"><pre class="highlight"><code>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES
02c1ee2be5ff        movieplex7-tomee    "catalina.sh run"   26 minutes ago      Up 26 minutes       0.0.0.0:8080-&gt;8080/tcp   javaeedemo_movieplex7_1
2a65e6f08819        react-client        "npm run start"     26 minutes ago      Up 26 minutes       0.0.0.0:80-&gt;3000/tcp     javaeedemo_react-client_1
</code></pre>
</div>

<p>This shows that the containers are running. Since there is overhead to start and deploy the war file you can look at the log files of the <code class="highlighter-rouge">movieplex7</code> container to check if it’s started</p>

<pre><code class="language-.term1">docker logs javaeedemo_movieplex7_1
</code></pre>
<div class="highlighter-rouge"><pre class="highlight"><code>...
02-Oct-2017 21:01:22.069 INFO [main] sun.reflect.DelegatingMethodAccessorImpl.invoke Starting ProtocolHandler [http-nio-8080]
02-Oct-2017 21:01:22.084 INFO [main] sun.reflect.DelegatingMethodAccessorImpl.invoke Starting ProtocolHandler [ajp-nio-8009]
02-Oct-2017 21:01:22.088 INFO [main] sun.reflect.DelegatingMethodAccessorImpl.invoke Server startup in 15073 ms
</code></pre>
</div>

<p>Now that the application server has started, you can click <a href="http://dockersamples.github.io/" data-term=".term1" data-port="80">here</a> and try out the new interface.</p>

<p><img src="images/react-movieplex7.png" alt="Movieplex7 React Front-end" /></p>

<p>And the old interface is still there, you can see it by clicking on <a href="http://dockersamples.github.io/movieplex7-1.0-SNAPSHOT" data-term=".term1" data-port="8080">here</a>.</p>

<hr />

<h2 id="survey">Survey</h2>
<p>We’re grateful you’ve chosen to spend some time with us today. We’d appreciate the opportunity to hear from  you about what you liked and what we might improve.</p>

<p>If you could please fill out this very short survey, it’d be greatly appreciated.</p>

<p>Thanks, the DockerCon Hands-on Labs team.</p>

<p><a href="https://docs.google.com/forms/d/e/1FAIpQLSfu5jatKvKLdGZviRQ7SdXaCKKUmLNYGz2-WyvQKVoIpGMaDQ/viewform?usp=pp_url&amp;entry.413124055=Modernizing+a+Traditional+Java+Application&amp;entry.879050699&amp;entry.54507413">Click Here for the survey</a></p>

            </div>
        </article>
    </div>

    
    <div class="splitter">
    </div>

    <div class="panel-right">
        <span class="resize-warning">If the commandline doesn't appear in the terminal, try resizing the browser window.</span>
        
        <div class="term1"></div>
        
    </div>
    

</div>

<script>
    (function() {
        var font3 = document.createElement('link');
        font3.type = 'text/css';
        font3.rel = 'stylesheet';
        font3.href = '/dceu-labs/css/syntax-highlighting.css';
        var q = document.getElementsByTagName('link')[0];
        q.parentNode.insertBefore(font3, q);
    })();
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://rawgit.com/RickStrahl/jquery-resizable/master/dist/jquery-resizable.min.js"></script>
<script src="https://rawgit.com/play-with-docker/sdk/hybrid/dist/pwd.js"></script>
<script>
    pwd.newSession([{selector: '.term1', type: ''}, {selector: '.term2', type: ''}, {selector: '.term3', type: ''}], {ImageName: '', baseUrl: 'https://dockercon.play-with-docker.com'});
      $(".panel-left").resizable({
      handleSelector: ".splitter",
      resizeHeight: false,
      onDragEnd: pwd.resize.bind(pwd)
  });

  window.onbeforeunload = function(e) {
        pwd.closeSession(function(){});
        return;
    }
</script>


    
<script async>
    (function() {
        var font = document.createElement('link'); 
        font.type = 'text/css'; 
        font.rel = 'stylesheet';
        font.href = '//fonts.googleapis.com/css?family=Raleway:400,700';
        var s = document.getElementsByTagName('link')[0]; 
        s.parentNode.insertBefore(font, s);
      })();
</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
 <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-6096819-32"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-6096819-32');
</script>


  </body>

</html>
